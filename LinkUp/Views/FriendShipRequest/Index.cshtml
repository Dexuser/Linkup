@model FriendShipRequestHomeIndex
@{
    ViewData["Title"] = "Solicitudes de amistad";
    Layout = "_Layout";
}
<div class="container-fluid gedf-wrapper">
    <div class="row">
        <!-- Panel lateral izquierdo -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0">
                <nav class="list-group list-group-flush">
                    <a asp-controller="" asp-action=""
                       class="list-group-item list-group-item-action text-dark fw-semibold no-link-style">
                        LinkUp (Home)
                    </a>
                    <a asp-controller="" asp-action=""
                       class="list-group-item list-group-item-action text-dark fw-semibold no-link-style">
                        Amigos
                    </a>
                    <a asp-controller="FriendShipRequest" asp-action="Index"
                       class="list-group-item list-group-item-action text-dark fw-semibold no-link-style">
                        Solicitudes de amistad
                    </a>
                    <a asp-controller="Battleship" asp-action="Index"
                       class="list-group-item list-group-item-action text-dark fw-semibold no-link-style">
                        Battleship
                    </a>
                </nav>
            </div>
        </div>


        <div class="col-md-6 gedf-main">
            <div class="row">
                @{
                    if (ViewBag.Message != null)
                    {
                        @if (ViewBag.Message is string)
                        {
                            <div class="alert alert-info alert-dismissible fade show" role="alert">
                                <p class="text-center">@Html.Raw(ViewBag.Message.Replace("\n", "<br />"))</p>
                                <br/>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-info alert-dismissible fade show" role="alert">
                                @foreach (var line in ViewBag.Message)
                                {
                                    <p class="text-center">@line</p>
                                }
                                <br/>
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        }
                    }
                }

                <div class="row mt-4">
                    <table class="table table-sm table-light table-striped">
                        <thead class="table-primary">
                        <tr>
                            <th>Usuario solicitante</th>
                            <th>Cant. de amigos comunes </th>
                            <th>Fecha de solicitud</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        @foreach (var item in Model.FriendShipRequests)
                        {
                            <tr>
                                <td>@($"{item.RequestedByUser!.UserName}")</td>
                                <td>@item.CommonFriendsCount</td>
                                <td>@item.CreatedAt.ToShortDateString()</td>
                                <td>
                                    <a class="btn btn-sm btn-outline-warning me-2" asp-controller="FriendShipRequest"
                                       asp-action="RespondRequest"
                                       asp-route-FriendShipRequestId="@item.Id"
                                       asp-route-accepted="true"
                                       asp-route-UserName="@item.RequestedByUser.UserName">
                                        Aceptar
                                    </a>

                                    <a class="btn btn-sm btn-outline-danger" asp-controller="FriendShipRequest"
                                       asp-action="RespondRequest"
                                       asp-route-FriendShipRequestId="@item.Id"
                                       asp-route-accepted="false"
                                       asp-route-UserName="@item.RequestedByUser.UserName">
                                        Rechazar
                                    </a>

                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>

                <a class="btn btn-success" asp-controller="FriendShipRequest" asp-action="Create">Crear una nueva solicitud</a>
                <div class="row mt-4">
                    <table class="table table-sm table-light table-striped">
                        <thead class="table-primary">
                        <tr>
                            <th>Usuario destino</th>
                            <th>Fecha de solicitud</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        @foreach (var item in Model.FriendShipTargets)
                        {
                            <tr>
                                <td>@($"{item.TargetUser!.UserName}")</td>
                                <td>@item.CreatedAt.ToShortDateString()</td>
                                <td>@item.StatusText</td>
                                <td>

                                    <a class="btn btn-sm btn-outline-danger" asp-controller="FriendShipRequest"
                                       asp-action="Delete"
                                       asp-route-id="@item.Id"
                                       asp-route-UserName="@item.TargetUser!.UserName">
                                        Eliminar
                                    </a>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <!-- Lateral derecho -->
        <div class="col-md-3">
            <div class="card gedf-card mb-3 shadow-sm border-0">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <img class="rounded-circle me-2" width="45" height="45"
                             src="@Model.CurrentUser.PhotoPath" alt="Imagen de perfil">
                        <div>
                            <div class="fw-bold h6 m-0">@($"{Model.CurrentUser.FirstName} {Model.CurrentUser.LastName}")</div>
                            <div class="text-muted small">@Model.CurrentUser.UserName</div>
                        </div>
                    </div>
                </div>
                <div class="bg-light text-center">
                    <nav class="list-group list-group-flush">
                        <a asp-controller="Login" asp-action="EditUser" asp-route-userid="@Model.CurrentUser.Id" 
                           class="list-group-item list-group-item-action fw-semibold no-link-style">
                            Mi perfil
                        </a>
                        <a asp-controller="Login" asp-action="Logout"
                           class="list-group-item list-group-item-action text-danger fw-semibold no-link-style">
                            Cerrar sesión
                        </a>
                    </nav>
                </div>
            </div>
        </div>
        
        
        
    </div>
</div>