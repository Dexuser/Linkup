@using System.Security.Claims
@using Microsoft.CodeAnalysis.CSharp.Syntax
@model BoardViewModel 

@{
    ViewBag.Title = "Elige la posicion de tu barco";
    Layout = "_Layout";
    string userId = User.FindFirstValue(ClaimTypes.NameIdentifier) ?? "";
}

@{
    if (ViewBag.Message != null)
    {
        @if (ViewBag.Message is string)
        {
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <p class="text-center">@Html.Raw(ViewBag.Message.Replace("\n", "<br />"))</p>
                <br/>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
        else
        {
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                @foreach (var line in ViewBag.Message)
                {
                    <p class="text-center">@line</p>
                }
                <br/>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
    }
}

<div class="battleship-board">
    <!-- Encabezado -->
    <div class="board-row">
        <div class="board-cell coordinate-cell"></div>
        @for (int x = 0; x < 12; x++)
        {
            <div class="board-cell coordinate-cell">
                <strong>@((char)('A' + x))</strong>
            </div>
        }
    </div>

    <!-- Filas -->
    @for (int x = 0; x < 12; x++)
    {
        <div class="board-row">
            <div class="board-cell coordinate-cell">
                <strong>@(x + 1)</strong>
            </div>

            @for (int y = 0; y < 12; y++)
            {
                var celda = Model.Cells[x][y];
                               
                <div class="board-cell">
                    @if (celda.CanBeSelected)
                    {
                        
                        <a asp-controller="Battleship"
                           asp-action="@(Model.Type == BoardType.Attack ? "Attack" : "SetShipPositionPost")"
                           asp-route-gameId="@Model.GameId"
                           asp-route-x="@celda.X"
                           asp-route-y="@celda.Y"
                           asp-route-selectedShip="@((int?)(Model?.SelectedShip ?? 0))"
                           class="btn @celda.CssClass cell-link">
                        </a>
                    }
                    else
                    {
                        <div class="btn @celda.CssClass cell-disabled">
                        </div>
                    }
                </div>
            }
        </div>
    }

    @if (Model.Type == BoardType.Preview)
    {
        <a class="btn btn-danger" asp-controller="Battleship" asp-action="Index">Volver atras</a>
    }
    @if (Model.Type == BoardType.Attack)
    {
        <a class="btn btn-warning" asp-controller="Battleship" asp-action="Index">Volver atras</a>
        <a class="btn btn-success" asp-controller="Battleship" asp-route-gameId="@Model.GameId"
           asp-route-userId="@userId" asp-action="RedirectToAttackBoard">Refrescar </a>
        <a class="btn btn-primary" asp-controller="Battleship" asp-route-gameId="@Model.GameId"
           asp-route-userId="@userId" asp-action="RedirectToShipsPreviewBoard">Ver mi tablero </a>
        <a class="btn btn-danger" asp-controller="Battleship" asp-route-gameId="@Model.GameId"
           asp-route-userId="@userId" asp-route-redirectToHome="@false" asp-action="GiveUpTheGame">Rendirse</a>
    }
    @if (Model.Type == BoardType.Results)
    {
        <a class="btn btn-warning" asp-controller="Battleship" asp-action="Index">Volver atras</a>
        <a class="btn btn-primary" asp-controller="Battleship" asp-route-gameId="@Model.GameId"
           asp-route-userId="@userId" asp-action="RedirectToShipsPreviewBoard">Ver mi tablero </a>       
        <a class="btn btn-danger" asp-controller="Battleship" asp-route-gameId="@Model.GameId"
           asp-route-userId="@userId" asp-route-showOpponentBoard="true" asp-action="RedirectToAttackPreviewBoard">Ver
            tablero contrincante</a>
    }
    
</div>
<style>
    /* ===== TABLERO ===== */
    .battleship-board {
        display: inline-block;
        border: 2px solid #343a40;
        background-color: #e9ecef;
        padding: 5px;
        border-radius: 5px;
        margin: 0 auto;
    }

    /* ===== FILAS DEL TABLERO ===== */
    .board-row {
        display: flex;
    }

    /* ===== CELDAS ===== */
    .board-cell {
        width: 40px;
        height: 40px;
        margin: 1px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Celdas de coordenadas */
    .coordinate-cell {
        background-color: #495057;
        color: white;
        font-weight: bold;
        border: 1px solid #343a40;
        font-size: 0.8rem;
    }

    /* Enlaces de celdas seleccionables */
    .cell-link {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        border: 1px solid #6c757d;
        border-radius: 3px;
        padding: 0;
    }

    .cell-link:hover {
        border-color: #007bff;
        opacity: 0.8;
    }

    /* Celdas deshabilitadas */
    .cell-disabled {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #ced4da;
        border-radius: 3px;
        padding: 0;
        cursor: not-allowed;
    }

    /* ===== ESTADOS DE LAS CELDAS ===== */

    /* Agua - No atacada */
    .cell-water {
        background-color: #4dabf7;  /* Azul más vibrante */
        border-color: #339af0;
    }

    /* Impacto - Ataque acertado */
    .cell-hit {
        background-color: #ff6b6b;  /* Rojo más vibrante */
        border-color: #fa5252;
    }

    /* Barco posicionado */
    .cell-ship {
        background-color: #495057;  /* Gris oscuro */
        border-color: #343a40;
    }

    /* Fallo - Ataque fallido */
    .cell-miss {
        background-color: #51cf66;  /* Verde */
        border-color: #40c057;
    }

    /* ===== RESPONSIVE ===== */
    @@media (max-width: 768px) {
        .board-cell {
            width: 30px;
            height: 30px;
        }
        
        .coordinate-cell {
            font-size: 0.7rem;
        }
    }
</style>